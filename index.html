<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê²€ ê°•í™” ê²Œì„ (ìµœê³ ê¸°ë¡ í¬í•¨)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 20px auto;
      padding: 10px;
      background: #f9f9f9;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
    }
    #log {
      white-space: normal;
      background: #222;
      color: #eee;
      padding: 10px;
      height: 200px;
      overflow-y: auto;
      font-family: monospace;
      border-radius: 5px;
      margin-top: 10px;
      user-select: none;
    }
    button {
      margin: 5px 3px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
      border: 1px solid #888;
      background: #fff;
      transition: background 0.2s ease;
    }
    button:hover {
      background: #eee;
    }
    #shop {
      margin-top: 15px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }
    p {
      margin: 6px 0;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h1>âš”ï¸ ê²€ ê°•í™” ê²Œì„</h1>
  <p>í˜„ì¬ ê°•í™” ë‹¨ê³„: <span id="level">+0</span></p>
  <p>ìµœê³  ê¸°ë¡: <span id="maxRecord">+0</span></p>
  <p>ë³´ìœ  ê³¨ë“œ: <span id="gold">1200</span> G</p>
  <p>íŒŒê´´ ë°©ì§€ê¶Œ: <span id="protector">0</span>ê°œ</p>
  <p>ë³µêµ¬ê¶Œ: <span id="restorer">0</span>ê°œ</p>
  <button class="btn" onclick="upgrade()">ê°•í™” ì‹œë„</button>
  <button class="btn" onclick="sell()">íŒë§¤</button>

  <div id="shop">
    <h3>ğŸª ìƒì </h3>
    <button class="btn" onclick="buyProtector()">íŒŒê´´ ë°©ì§€ê¶Œ êµ¬ë§¤ (500G)</button>
    <button class="btn" onclick="buyRestorer()">ë³µêµ¬ê¶Œ êµ¬ë§¤ (1000G)</button>
  </div>

  <div id="log"></div>

  <script>
    let level = 0;
    let maxRecord = 0;
    let gold = 1200;
    let protector = 0;
    let restorer = 0;
    let lastLevelBeforeDestroy = 0;

    const fixedUpgradeCost = 50;
    const maxLevel = 15;

    function log(msg) {
      const logBox = document.getElementById("log");
      logBox.innerHTML += `> ${msg}<br>`;
      logBox.scrollTop = logBox.scrollHeight;
    }

    function updateUI() {
      document.getElementById("level").textContent = `+${level}`;
      document.getElementById("maxRecord").textContent = `+${maxRecord}`;
      document.getElementById("gold").textContent = gold;
      document.getElementById("protector").textContent = protector;
      document.getElementById("restorer").textContent = restorer;
    }

    function getSuccessRate(currentLevel) {
      let rate = 1 - (currentLevel * 0.06);
      if (rate < 0.03) rate = 0.03;
      return rate;
    }

    function upgrade() {
      if (level >= maxLevel) {
        log("ğŸš« ìµœëŒ€ ê°•í™” ë‹¨ê³„ì…ë‹ˆë‹¤. ë” ì´ìƒ ê°•í™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      if (gold < fixedUpgradeCost) {
        log("ğŸ’° ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
        return;
      }

      gold -= fixedUpgradeCost;
      const chance = getSuccessRate(level);
      const roll = Math.random();
      log(`âš”ï¸ ê°•í™” ì‹œë„ (ë¹„ìš©: ${fixedUpgradeCost}G, í™•ë¥ : ${(chance * 100).toFixed(1)}%)`);

      if (roll < chance) {
        level++;
        log(`âœ¨ ê°•í™” ì„±ê³µ! í˜„ì¬ ë‹¨ê³„: +${level}`);

        // ìµœê³  ê¸°ë¡ ê°±ì‹ 
        if (level > maxRecord) {
          maxRecord = level;
          log(`ğŸ† ìµœê³  ê¸°ë¡ ê°±ì‹ ! +${maxRecord} ë‹¨ê³„ ë‹¬ì„±!`);
          alert(`ğŸ† ì¶•í•˜í•©ë‹ˆë‹¤! ìµœê³  ê¸°ë¡ +${maxRecord}ë‹¨ê³„ ë‹¬ì„±!`);
        }
      } else {
        lastLevelBeforeDestroy = level;
        if (level >= 7 && protector > 0) {
          const useProtector = confirm("â—ê°•í™” ì‹¤íŒ¨ ì‹œ ì¥ë¹„ê°€ íŒŒê´´ë©ë‹ˆë‹¤. íŒŒê´´ ë°©ì§€ê¶Œì„ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
          if (useProtector) {
            protector--;
            log("ğŸ›¡ï¸ íŒŒê´´ ë°©ì§€ê¶Œì„ ì‚¬ìš©í•˜ì—¬ ì¥ë¹„ë¥¼ ë³´í˜¸í–ˆìŠµë‹ˆë‹¤.");
          } else {
            handleDestroy();
          }
        } else {
          handleDestroy();
        }
      }
      updateUI();
      checkGameOver();
    }

    function handleDestroy() {
      if (restorer > 0 && lastLevelBeforeDestroy > 0) {
        const useRestorer = confirm(`${lastLevelBeforeDestroy}ë‹¨ê³„ê¹Œì§€ ë„ë‹¬í•˜ì…¨ìŠµë‹ˆë‹¤! ê¸°ë¡ì„ ë‹¤ì‹œ ë³µêµ¬í• ê¹Œìš”?`);
        if (useRestorer) {
          restorer--;
          level = lastLevelBeforeDestroy;
          log(`â™»ï¸ ë³µêµ¬ê¶Œì„ ì‚¬ìš©í•˜ì—¬ +${level}ë‹¨ê³„ë¶€í„° ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.`);
          lastLevelBeforeDestroy = 0;
          updateUI();
          return;
        }
      }
      log("ğŸ’¥ ê°•í™” ì‹¤íŒ¨! ì¥ë¹„ê°€ íŒŒê´´ë˜ì–´ +0ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.");
      alert("ğŸ’¥ ê°•í™” ì‹¤íŒ¨! ì¥ë¹„ê°€ íŒŒê´´ë˜ì—ˆìŠµë‹ˆë‹¤.");
      level = 0;
      lastLevelBeforeDestroy = 0;
    }

    function sell() {
      if (level === 0) {
        log("âŒ +0 ì¥ë¹„ëŠ” íŒë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      const sellValue = level * 150;
      gold += sellValue;
      log(`ğŸ’¸ ì¥ë¹„ë¥¼ íŒë§¤í•˜ì—¬ ${sellValue}Gë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤. (+${level} â†’ +0)`);
      level = 0;
      updateUI();
      checkGameOver();
    }

    function buyProtector() {
      if (protector >= 2) {
        log("âš ï¸ íŒŒê´´ ë°©ì§€ê¶Œì€ ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ë³´ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }
      if (gold < 500) {
        log("ğŸ’° ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        return;
      }
      gold -= 500;
      protector++;
      log("âœ… íŒŒê´´ ë°©ì§€ê¶Œì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.");
      updateUI();
    }

    function buyRestorer() {
      if (level === 0) {
        alert("âŒ +0ë‹¨ê³„ ì¥ë¹„ëŠ” ë³µêµ¬ê¶Œì„ êµ¬ë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      if (restorer >= 1) {
        log("âš ï¸ ë³µêµ¬ê¶Œì€ 1ê°œë§Œ ë³´ìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }
      if (gold < 1000) {
        log("ğŸ’° ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        return;
      }
      gold -= 1000;
      restorer++;
      log("âœ… ë³µêµ¬ê¶Œì„ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.");
      updateUI();
    }

    function checkGameOver() {
      if (gold < fixedUpgradeCost && level === 0) {
        const restart = confirm("ğŸ’€ ê³¨ë“œê°€ ë¶€ì¡±í•˜ê³  íŒë§¤í•  ì¥ë¹„ë„ ì—†ìŠµë‹ˆë‹¤! ê²Œì„ ì˜¤ë²„! ë‹¤ì‹œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
        if (restart) {
          resetGame();
        } else {
          log("ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
          document.querySelectorAll("button").forEach(btn => btn.disabled = true);
        }
      }
    }

    function resetGame() {
      level = 0;
      maxRecord = 0;
      gold = 1200;
      protector = 0;
      restorer = 0;
      lastLevelBeforeDestroy = 0;
      log("ê²Œì„ì„ ìƒˆë¡œ ì‹œì‘í•©ë‹ˆë‹¤!");
      updateUI();
      document.getElementById("log").innerHTML = "";
      document.querySelectorAll("button").forEach(btn => btn.disabled = false);
    }

    updateUI();
  </script>
</body>
</html>
